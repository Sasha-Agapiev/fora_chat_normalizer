# Travel Support Message Normalizer

AI-powered message classification and enrichment API for Fora's customer support team.

## Overview

This API preprocesses customer support messages to:
1. **Classify** urgency and risk levels (high_risk, urgent, base)
2. **Extract** contact information and travel entities 
3. **Enrich** with emergency numbers, message sentiment analysis, client travel phase, and recommended support actions (listed in order of priority). 

## Quick Start

### Prerequisites
- Python 3.11+
- OpenAI API key
- Docker (optional)

### Environment Setup
```bash
# Clone repository
git clone https://github.com/Sasha-Agapiev/fora_chat_normalizer

# Set environment variables
export OPENAI_API_KEY="your-openai-api-key"

# Install dependencies
pip install -r requirements.txt

# Run tests
python test_api.py

# Start server
uvicorn main:app --reload
```

### Docker Deployment
```bash
docker build -t travel-normalizer .
docker run -p 8000:8000 -e OPENAI_API_KEY="your-key" travel-normalizer
```

## API Usage

### Endpoint: `POST /normalize`

**Input:**
```json
{
  "message_id": "msg_001",
  "text": "my wallet was stolen in Paris last night"
}
```

**Output:**
```json
{
  "message_id": "msg_001",
  "category": "high_risk",
  "contact": null,
  "entities": [
    {"type": "city", "value": "Paris"}
  ],
  "enrichment": {
    "local_emergency_numbers": ["112"],
    "sentiment_analysis": {"mood": "stressed", "intensity": 0.8},
    "travel_phase": "in_transit"
  }
}
```

## Architecture

### Classification Logic
- **Hybrid approach**: OpenAI GPT-4o-mini + rule-based validation
- **Priority system**: high_risk > urgent > base
- **Fallback protection**: Rules-based classification if LLM fails

### Entity Extraction
- **Cities, Hotels, and Restaurants**: Combination of SpaCy named entity recognition and OpenAI GPT-4o-mini

### Contact Information Extraction
- Done using simple Regex with Python phonenumbers library.
- <span style="color:red"> I did not use OpenAI for this to decrease cost and latency </span>.


### Enrichments
- **Emergency numbers**: Emergency number API (emergencynumberapi.com) for with fallback data
- **Sentiment analysis**: Keyword-based mood detection with ratio-based confidence calculation
- **Travel context**: Keyword-based trip phase analysis (pre-trip, during trip, post-trip)
- **Recommended Support Actions**: OpenAI GPT-4o-mini API call with prompt containing client message + extracted entities

## Performance

- **Latency**: <8s average (p95 <20s requirement)
- **Reliability**: 99.5% uptime guaranteed by Railway
- **Accuracy**: 100% accuracy on set of 30 test messages generated by Claude

## Testing

Run the test suite:
```bash
python test_api.py
```

Test cases include:
- High-risk scenarios (theft, medical emergencies)
- Urgent requests (time-sensitive bookings)
- Regular inquiries (trip planning)
- Contact extraction validation

## Future Roadmap

- [ ] Multi-language support (Spanish, French, German)
- [ ] Integration with booking systems APIs
- [ ] Integration with APIs for FX exchange rate, local weather, and travel advisories
- [ ] ML model fine-tuning on customer data
- [ ] Automated escalation workflows
